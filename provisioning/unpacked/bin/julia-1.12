#!/bin/bash
set -e

jl_sel="julia-1.12"

this_script_dir="$(cd "$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")" && pwd)"
unpacked_dir=`dirname "$this_script_dir"`
img_dir=`dirname "$unpacked_dir"`
img_name=`cat "$unpacked_dir/image-name"`

# Julia and Julia artifacts often fail if LD_LIBRARY_PATH points to
# conflicting libraries, so unset it:
unset LD_LIBRARY_PATH

source "$unpacked_dir/env.sh"

# If no JULIA_DEPOT_PATH is set, use an image-specific one, to help users
# avoid conflicts with local Julia installations, etc.:
if [ -z "$JULIA_DEPOT_PATH" ] ; then
    export JULIA_DEPOT_PATH="$HOME/.julia-$img_name:"
fi

exec "$img_dir/opt/$jl_sel/bin/julia" "$@"
